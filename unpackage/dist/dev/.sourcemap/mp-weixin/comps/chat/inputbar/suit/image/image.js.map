{"version":3,"sources":["webpack:////Users/lr/Documents/work/easemob-uniapp/webim-uniapp-demo/comps/chat/inputbar/suit/image/image.vue?1e6a","webpack:////Users/lr/Documents/work/easemob-uniapp/webim-uniapp-demo/comps/chat/inputbar/suit/image/image.vue?10b9","webpack:////Users/lr/Documents/work/easemob-uniapp/webim-uniapp-demo/comps/chat/inputbar/suit/image/image.vue?e66f","webpack:////Users/lr/Documents/work/easemob-uniapp/webim-uniapp-demo/comps/chat/inputbar/suit/image/image.vue?f6dc","webpack:////Users/lr/Documents/work/easemob-uniapp/webim-uniapp-demo/comps/chat/inputbar/suit/image/image.vue"],"names":["WebIM","require","msgType","disp","msgStorage","data","components","props","username","type","Object","default","chatType","String","SINGLE_CHAT","methods","openCamera","me","wx","chooseImage","count","sizeType","sourceType","success","res","upLoadImage","sendImage","isGroupChat","CHAT_ROOM","getSendToParam","groupId","your","tempFilePaths","token","conn","context","accessToken","getImageInfo","src","allowType","jpg","gif","png","bmp","str","config","appkey","split","width","height","index","path","lastIndexOf","filetype","slice","toLowerCase","uploadFile","url","filePath","name","header","Authorization","dataObj","JSON","parse","id","getUniqueId","console","log","msg","message","IMAGE","file","size","uri","entities","uuid","filename","set","apiUrl","apiURL","body","from","myName","to","roomType","argument","fire","setGroup","send","obj","saveSendMsg","evt","saveMsg"],"mappings":"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","file":"comps/chat/inputbar/suit/image/image.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./image.vue?vue&type=template&id=335c69c4&\"\nvar renderjs\nimport script from \"./image.vue?vue&type=script&lang=js&\"\nexport * from \"./image.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"Users/lr/Documents/work/easemob-uniapp/webim-uniapp-demo/comps/chat/inputbar/suit/image/image.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./image.vue?vue&type=template&id=335c69c4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./image.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./image.vue?vue&type=script&lang=js&\"","//\n//\n//\n\nlet WebIM = require(\"../../../../../utils/WebIM\")[\"default\"];\nlet msgType = require(\"../../../msgtype\");\nlet disp = require(\"../../../../../utils/broadcast\");\nlet msgStorage = require(\"../../../msgstorage\");\nexport default {\n  data() {\n    return {};\n  },\n\n  components: {},\n  props: {\n    username: {\n      type: Object,\n      default: () => ({})\n    },\n    chatType: {\n      type: String,\n      default: msgType.chatType.SINGLE_CHAT\n    }\n  },\n  methods: {\n    openCamera() {\n      var me = this;\n      wx.chooseImage({\n        count: 1,\n        sizeType: [\"original\", \"compressed\"],\n        sourceType: [\"camera\"],\n\n        success(res) {\n          me.upLoadImage(res);\n        }\n\n      });\n    },\n\n    sendImage() {\n      var me = this;\n      wx.chooseImage({\n        count: 1,\n        sizeType: [\"original\", \"compressed\"],\n        sourceType: [\"album\"],\n\n        success(res) {\n          me.upLoadImage(res);\n        }\n\n      });\n    },\n\n    isGroupChat() {\n      return this.chatType == msgType.chatType.CHAT_ROOM;\n    },\n\n    getSendToParam() {\n      return this.isGroupChat() ? this.username.groupId : this.username.your;\n    },\n\n    upLoadImage(res) {\n      var me = this;\n      var tempFilePaths = res.tempFilePaths;\n      var token = WebIM.conn.context.accessToken;\n      wx.getImageInfo({\n        src: res.tempFilePaths[0],\n\n        success(res) {\n          var allowType = {\n            jpg: true,\n            gif: true,\n            png: true,\n            bmp: true\n          };\n          var str = WebIM.config.appkey.split(\"#\");\n          var width = res.width;\n          var height = res.height;\n          var index = res.path.lastIndexOf(\".\");\n          var filetype = ~index && res.path.slice(index + 1) || \"\";\n\n          if (filetype.toLowerCase() in allowType) {\n            wx.uploadFile({\n              url: \"https://a1.easemob.com/\" + str[0] + \"/\" + str[1] + \"/chatfiles\",\n              filePath: tempFilePaths[0],\n              name: \"file\",\n              header: {\n                \"Content-Type\": \"multipart/form-data\",\n                Authorization: \"Bearer \" + token\n              },\n\n              success(res) {\n                var data = res.data;\n                var dataObj = JSON.parse(data);\n                var id = WebIM.conn.getUniqueId(); // 生成本地消息 id\n                console.log('dataObj>>',dataObj);\n                \n                var msg = new WebIM.message(msgType.IMAGE, id);\n                var file = {\n                  type: msgType.IMAGE,\n                  size: {\n                    width: width,\n                    height: height\n                  },\n                  url: dataObj.uri + \"/\" + dataObj.entities[0].uuid,\n                  filetype: filetype,\n                  filename: tempFilePaths[0]\n                };\n                msg.set({\n                  apiUrl: WebIM.config.apiURL,\n                  body: file,\n                  from: me.username.myName,\n                  to: me.getSendToParam(),\n                  roomType: false,\n                  chatType: me.chatType,\n                  success: function (argument) {\n                    disp.fire('em.chat.sendSuccess', id);\n                  }\n                });\n\n                if (me.chatType == msgType.chatType.CHAT_ROOM) {\n                  msg.setGroup(\"groupchat\");\n                }\n\n                WebIM.conn.send(msg.body);\n                let obj = {\n                  msg: msg,\n                  type: msgType.IMAGE\n                }\n                me.saveSendMsg(obj);\n              }\n            });\n          }\n        }\n      });\n    },\n    saveSendMsg(evt) {\n      msgStorage.saveMsg(evt.msg, evt.type);\n    }\n\n  }\n};\n"],"sourceRoot":""}